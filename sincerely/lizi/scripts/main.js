"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S={init:function(){S.Drawing.init(".canvas"),S.UI.simulate("凡凡|凡凡|祝你|祝你|永远| |开心|"),S.UI.simulate("凡凡祝你永远开心"),S.UI.simulate("♥"),S.Drawing.loop(function(){S.Shape.render()})}};S.Drawing=function(){var t,i,n,e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};return{init:function(n){t=document.querySelector(n),i=t.getContext("2d"),this.adjustCanvas(),window.addEventListener("resize",function(t){S.Drawing.adjustCanvas()})},loop:function(t){n=n||t,this.clearFrame(),n(),e.call(window,this.loop.bind(this))},adjustCanvas:function(){t.width=window.innerWidth,t.height=window.innerHeight},clearFrame:function(){i.clearRect(0,0,t.width,t.height)},getArea:function(){return{w:t.width,h:t.height}},drawCircle:function(t,n){i.fillStyle=n.render(),i.beginPath(),i.arc(t.x,t.y,t.z,0,2*Math.PI,!0),i.closePath(),i.fill()}}}(),S.UI=function(){function t(t){return t&&t.split(" ")[1]}function i(t){return(t=t&&t.split(" ")[0])&&t[0]===s&&t.substring(1)}function n(t,i,n,e){clearInterval(o),h=e?n:1,t(h),(!n||!e&&h<n||e&&h>0)&&(o=setInterval(function(){h=e?h-1:h+1,t(h),(!e&&n&&h===n||e&&0===h)&&clearInterval(o)},i))}function e(e){var o,e,h;r="object"===(void 0===e?"undefined":_typeof(e))?e:r.concat(e.split("|")),n(function(n){h=r.shift(),o=i(h),e=t(h),S.Shape.switchShape(S.ShapeBuilder.letter(h[0]===s?"What?":h))},3e3,r.length)}var o,h,a=(document.querySelector(".ui"),document.querySelector(".canvas"),!1),r=[],s="#";return function(){a&&document.body.classList.add("touch")}(),{simulate:function(t){e(t)}}}(),S.Point=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.a=t.a,this.h=t.h},S.Color=function(t,i,n,e){this.r=t,this.g=i,this.b=n,this.a=e},S.Color.prototype={render:function(){return"rgba("+this.r+","+ +this.g+","+this.b+","+this.a+")"}},S.Dot=function(t,i){this.p=new S.Point({x:t,y:i,z:5,a:1,h:0}),this.e=.07,this.s=!0,this.c=new S.Color(255,255,255,this.p.a),this.t=this.clone(),this.q=[]},S.Dot.prototype={clone:function(){return new S.Point({x:this.x,y:this.y,z:this.z,a:this.a,h:this.h})},_draw:function(){this.c.a=this.p.a,S.Drawing.drawCircle(this.p,this.c)},_moveTowards:function(t){var i=this.distanceTo(t,!0),n=i[0],e=i[1],o=i[2],h=this.e*o;if(-1===this.p.h)return this.p.x=t.x,this.p.y=t.y,!0;if(o>1)this.p.x-=n/o*h,this.p.y-=e/o*h;else{if(!(this.p.h>0))return!0;this.p.h--}return!1},_update:function(){if(this._moveTowards(this.t)){var t=this.q.shift();t?(this.t.x=t.x||this.p.x,this.t.y=t.y||this.p.y,this.t.z=t.z||this.p.z,this.t.a=t.a||this.p.a,this.p.h=t.h||0):this.s?(this.p.x-=Math.sin(3.142*Math.random()),this.p.y-=Math.sin(3.142*Math.random())):this.move(new S.Point({x:this.p.x+50*Math.random()-25,y:this.p.y+50*Math.random()-25}))}var i=this.p.a-this.t.a;this.p.a=Math.max(.1,this.p.a-.05*i),i=this.p.z-this.t.z,this.p.z=Math.max(1,this.p.z-.05*i)},distanceTo:function(t,i){var n=this.p.x-t.x,e=this.p.y-t.y,o=Math.sqrt(n*n+e*e);return i?[n,e,o]:o},move:function(t,i){(!i||i&&this.distanceTo(t)>1)&&this.q.push(t)},render:function(){this._update(),this._draw()}},S.ShapeBuilder=function(){function t(){h.width=Math.floor(window.innerWidth/o)*o,h.height=Math.floor(window.innerHeight/o)*o,a.fillStyle="red",a.textBaseline="middle",a.textAlign="center"}function i(){for(var t,t=a.getImageData(0,0,h.width,h.height).data,i=[],n=0,e=0,r=h.width,s=h.height,c=0,u=0,d=0;d<t.length;d+=4*o)t[d+3]>0&&(i.push(new S.Point({x:n,y:e})),c=n>c?n:c,u=e>u?e:u,r=n<r?n:r,s=e<s?e:s),(n+=o)>=h.width&&(n=0,e+=o,d+=4*o*h.width);return{dots:i,w:c+r,h:u+s}}function n(t){a.font="bold "+t+"px "+r}function e(t){return!isNaN(parseFloat(t))&&isFinite(t)}var o=13,h=document.createElement("canvas"),a=h.getContext("2d"),r="Avenir, Helvetica Neue, Helvetica, Arial, sans-serif";return function(){t(),window.addEventListener("resize",t)}(),{imageFile:function(t,n){var e=new Image,o=S.Drawing.getArea();e.onload=function(){a.clearRect(0,0,h.width,h.height),a.drawImage(this,0,0,.6*o.h,.6*o.h),n(i())},e.onerror=function(){n(S.ShapeBuilder.letter("What?"))},e.src=t},circle:function(t){var n=Math.max(0,t)/2;return a.clearRect(0,0,h.width,h.height),a.beginPath(),a.arc(n*o,n*o,n*o,0,2*Math.PI,!1),a.fill(),a.closePath(),i()},letter:function(t){var o=0;return n(500),o=Math.min(500,h.width/a.measureText(t).width*.8*500,h.height/500*(e(t)?1:.45)*500),n(o),a.clearRect(0,0,h.width,h.height),a.fillText(t,h.width/2,h.height/2),i()},rectangle:function(t,i){for(var n=[],e=o*t,h=o*i,a=0;a<h;a+=o)for(var r=0;r<e;r+=o)n.push(new S.Point({x:r,y:a}));return{dots:n,w:e,h:h}}}}(),S.Shape=function(){function t(){var t=S.Drawing.getArea();o=t.w/2-n/2,h=t.h/2-e/2}var i=[],n=0,e=0,o=0,h=0;return{shuffleIdle:function(){for(var t=S.Drawing.getArea(),n=0;n<i.length;n++)i[n].s||i[n].move({x:Math.random()*t.w,y:Math.random()*t.h})},switchShape:function(a,r){var s,c=S.Drawing.getArea();if(n=a.w,e=a.h,t(),a.dots.length>i.length){s=a.dots.length-i.length;for(var u=1;u<=s;u++)i.push(new S.Dot(c.w/2,c.h/2))}for(var u=0,d=0;a.dots.length>0;)d=Math.floor(Math.random()*a.dots.length),i[u].e=r?.25:i[u].s?.14:.11,i[u].s?i[u].move(new S.Point({z:20*Math.random()+10,a:Math.random(),h:18})):i[u].move(new S.Point({z:5*Math.random()+5,h:r?18:30})),i[u].s=!0,i[u].move(new S.Point({x:a.dots[d].x+o,y:a.dots[d].y+h,a:1,z:5,h:0})),a.dots=a.dots.slice(0,d).concat(a.dots.slice(d+1)),u++;for(var d=u;d<i.length;d++)i[d].s&&(i[d].move(new S.Point({z:20*Math.random()+10,a:Math.random(),h:20})),i[d].s=!1,i[d].e=.04,i[d].move(new S.Point({x:Math.random()*c.w,y:Math.random()*c.h,a:.3,z:4*Math.random(),h:0})))},render:function(){for(var t=0;t<i.length;t++)i[t].render()}}}(),S.init();